"0","#| warning: false"
"0","#| message: false"
"0","#| echo: false"
"0","#| label: fig-catdis"
"0","#| fig-cap: ""Distribution of categorical varibales"""
"0",""
"0","### Plot distributions for categorical variables ###"
"0","# Define the categorical variables to plot"
"0","categorical_variables <- setdiff(variables_to_extract, c(numeric_variables, ""start_date"", ""end_date""))"
"0","categorical_variables <- categorical_variables[categorical_variables != ""methodology"" ]"
"0","categorical_variables <- categorical_variables[categorical_variables != ""poll_id"" ]"
"0","# Create a list to store plots for categorical variables"
"0","categorical_plots <- list()"
"0",""
"0","# Loop through categorical variables and plot their distributions"
"0","for (variable in categorical_variables) {"
"0","  plot <- ggplot(raw_data, aes_string(x = variable)) +"
"0","    geom_bar(fill = ""skyblue"", color = ""black"") +"
"0","    labs(title = paste(variable), x = variable, y = ""Count"") +"
"0","    theme_minimal() +"
"0","    theme(plot.title = element_text(hjust = 0.5))"
"0","  "
"0","  # Add plot to list"
"0","  categorical_plots[[variable]] <- plot"
"0","}"
"0",""
"0",""
"0","### Plot top 5 methodologies ###"
"0","# Extract top 5 methodologies by frequency"
"0","top_5_methodologies <- raw_data %>%"
"0","  count(methodology, sort = TRUE) %>%"
"0","  top_n(5) %>%"
"0","  pull(methodology)"
"0",""
"0","# Create a new column to categorize methodologies into top 5 and 'Other'"
"0","raw_data$methodology_grouped <- ifelse(raw_data$methodology %in% top_5_methodologies, raw_data$methodology, 'Other')"
"0",""
"0","# Plot the distribution of the top 5 methodologies plus 'Other'"
"0","methodology_plot <- ggplot(raw_data, aes(x = methodology_grouped)) +"
"0","  geom_bar(fill = ""skyblue"", color = ""black"") +"
"0","  labs(title = ""Top 5 Methodologies and Others"", x = ""Methodology"", y = ""Count"") +"
"0","  theme_minimal() +"
"0","  theme(plot.title = element_text(hjust = 0.5))"
"0",""
"0","# Add methodology plot to categorical plots list"
"0","categorical_plots[[""methodology_grouped""]] <- methodology_plot"
"0",""
"0",""
"0","# Combine all individual plots for categorical variables into one using patchwork"
"0","combined_categorical_plot <- wrap_plots(categorical_plots) +"
"0","  plot_annotation(title = ""Distributions of Categorical Variables"")"
"0",""
"0","# Print the combined plot for categorical variables"
"0","print(combined_categorical_plot)"
